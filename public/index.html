<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>حجز دور - بنك البركة</title><style>body{font-family:Arial;background:#f6f7fb;margin:0}.w{max-width:900px;margin:20px auto;padding:12px}.c{background:#fff;border:1px solid #ddd;border-radius:12px;padding:14px}.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}.slots{display:grid;grid-template-columns:repeat(4,minmax(80px,1fr));gap:8px}.slot{padding:8px;border-radius:8px;border:1px solid #bbb;text-align:center;cursor:pointer}.na{background:#fde2e2;color:#a00;cursor:not-allowed}.ok{background:#e8f6ec}.sel{outline:3px solid #2d6cdf}.msg{margin-top:10px;font-weight:bold}.full{width:100%}button{padding:10px 14px;background:#2d6cdf;color:#fff;border:0;border-radius:8px;cursor:pointer}</style></head><body><div class="w"><div class="c"><h2>منصة حجز موعد استلام حوالة - بنك البركة</h2><div class="grid"><div><label>رقم الحوالة</label><input id="transfer" class="full"></div><div><label>رقم الهاتف</label><input id="phone" class="full"></div><div><label>الفرع</label><select id="branch" class="full"></select></div><div><label>شركة الحوالات</label><select id="company" class="full"></select></div><div><label>اليوم</label><select id="day" class="full"></select></div><div><label>رمز التحقق CAPTCHA</label><div id="captchaQ"></div><input id="captchaA" class="full" placeholder="الإجابة"></div></div><h3>الأوقات المتاحة</h3><div id="slots" class="slots"></div><div style="margin-top:10px"><button onclick="sendOtp()">إرسال رمز 4 خانات</button> <input id="otp" placeholder="OTP" style="padding:8px"> <button onclick="book()">تأكيد الحجز</button></div><div class="msg" id="msg"></div></div></div><script>
let captchaToken='';let selectedSlot='';
async function j(u,o){const r=await fetch(u,o);return await r.json()}
async function init(){
 const b=await j('/api/branches');branch.innerHTML=b.branches.map(x=>`<option value="${x.id}">${x.name} (${x.code}) - ${x.location}</option>`).join('');
 const c=await j('/api/companies');company.innerHTML=c.companies.map(x=>`<option value="${x.id}">${x.name} - ${x.description||''}</option>`).join('');
 const cap=await j('/api/captcha');captchaQ.textContent=cap.question;captchaToken=cap.token;
 await loadDays();
}
async function loadDays(){const d=await j('/api/business-days?branch_id='+branch.value);day.innerHTML=d.days.map(x=>`<option value="${x.day_name}">${x.day_name} (${x.start_time}-${x.end_time})</option>`).join('');await loadSlots()}
async function loadSlots(){selectedSlot='';const s=await j(`/api/slots?branch_id=${branch.value}&day_name=${encodeURIComponent(day.value)}`);slots.innerHTML=s.slots.map(x=>`<div class="slot ${x.available?'ok':'na'}" data-t="${x.time}">${x.time}</div>`).join('');document.querySelectorAll('.slot.ok').forEach(el=>el.onclick=()=>{document.querySelectorAll('.slot').forEach(a=>a.classList.remove('sel'));el.classList.add('sel');selectedSlot=el.dataset.t;});}
branch.onchange=loadDays;day.onchange=loadSlots;
async function sendOtp(){const r=await j('/api/send-otp',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({phone:phone.value,transfer_number:transfer.value,captcha_answer:captchaA.value,captcha_token:captchaToken})});msg.textContent=r.message||r.error||'';}
async function book(){const r=await j('/api/book',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({transfer_number:transfer.value,branch_id:branch.value,company_id:company.value,day_name:day.value,slot_time:selectedSlot,phone:phone.value,otp_code:otp.value})});msg.textContent=r.message||r.error||'';if(r.success){msg.style.color='green';await loadSlots()}else{msg.style.color='red'}}
init();
</script></body></html>
