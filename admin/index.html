<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>لوحة التحكم</title><style>body{font-family:Arial;background:#f6f7fb}.w{max-width:1000px;margin:20px auto}.c{background:#fff;border:1px solid #ddd;border-radius:12px;padding:14px}table{width:100%;border-collapse:collapse}td,th{border:1px solid #ddd;padding:6px}button{padding:6px 10px}</style></head><body><div class="w"><div class="c"><h2>لوحة إدارة مواعيد الحوالات</h2><div id="login"><input id="u" placeholder="username"> <input id="p" type="password" placeholder="password"> <button onclick="login()">دخول</button><p>افتراضي: admin/admin1234</p></div><div id="panel" style="display:none"><label>الفرع</label><input id="f"> <label>اليوم</label><input id="d"> <button onclick="load()">فلترة</button><table><thead><tr><th>ID</th><th>الفرع</th><th>الشركة</th><th>اليوم</th><th>الوقت</th><th>الهاتف</th><th>الحالة</th><th>إجراء</th></tr></thead><tbody id="tb"></tbody></table></div></div></div><script>
let token='';let role='';
async function j(u,o){const r=await fetch(u,o);return await r.json()}
async function login(){const r=await j('/api/admin/login',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({username:u.value,password:p.value})});if(r.token){token=r.token;role=r.role;login.style='display:none';panel.style.display='block';load();}else alert(r.error||'fail')}
async function load(){const q=[];if(f.value)q.push('branch_id='+encodeURIComponent(f.value));if(d.value)q.push('day_name='+encodeURIComponent(d.value));const r=await j('/api/admin/appointments'+(q.length?'?'+q.join('&'):''),{headers:{Authorization:'Bearer '+token}});tb.innerHTML=(r.appointments||[]).map(x=>`<tr><td>${x.id}</td><td>${x.branch_name}</td><td>${x.company_name}</td><td>${x.day_name}</td><td>${x.slot_time}</td><td>${x.phone}</td><td>${x.status}</td><td>${role==='admin'?`<button onclick="del(${x.id})">حذف</button>`:''}</td></tr>`).join('')}
async function del(id){await fetch('/api/admin/appointments/'+id,{method:'DELETE',headers:{Authorization:'Bearer '+token}});load()}
</script></body></html>
